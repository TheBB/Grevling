let {cmd} = import("grevling")

let formats = ["mock", "matplotlib", "csv", "plotly"]
let capture = (name) => [{
    type: "integer",
    name: name,
    prefix: "result",
    mode: "all",
}]

in {
    parameters: {
        i: [1, 2, 3, 4, 5],
        j: [1, 2, 4, 8, 16],
        k: ["a", "b", "c"],
    },
    evaluate: ({i, j, k}) => {
        isq: i^2,
        jlog: log(j),
        misc: i + j + ord(k),
        pi: 3.1415,
        e: 2.7182
    },
    script: ({i}) => [
        cmd(
            ["sh", "-c", "for i in `seq 1 ${i}`; do echo result $i; done"],
            name: "sh-v",
            capture: capture("vresult"),
        ),
        cmd(
            ["sh", "-c", "for i in `seq 1 10`; do echo result $i; done"],
            name: "sh-f",
            capture: capture("fresult"),
        ),
    ],
    plots: [
        {
            parameters: {i: "variate"},
            filename: "i-vs-isq",
            format: formats,
            yaxis: "isq",
            grid: false,
        },
        {
            parameters: {i: "variate", j: "mean", k: "fixed"},
            filename: "misc-vs-i-\${k}",
            format: formats,
            yaxis: "misc",
            title: "This is a plot for k=\${k}",
            xlabel: "x (\${k})",
            ylabel: "y (\${k})",
            xmode: "log",
        },
        {
            filename: "fresult",
            format: formats,
            yaxis: "fresult",
            ymode: "log",
        },
        {
            parameters: {i: "mean", j: "mean", k: "ignore"},
            yaxis: "fresult",
            filename: "fresult-mean",
            format: formats,
            xmode: "log",
            ymode: "log",
        },
        {
            parameters: {i: "mean", j: "mean", k: "ignore"},
            yaxis: "fresult",
            filename: "fresult-allmean",
            format: formats,
        },
        {
            parameters: {i: {mode: "category", style: "color"}},
            filename: "vresult",
            format: formats,
            yaxis: "vresult",
            legend: "i is \${i} - \${yaxis}",
        },
        {
            parameters: {for k in ["i", "j", "k"]: $k: "variate"},
            filename: "scatter",
            format: formats,
            xaxis: "j",
            yaxis: ["misc"],
        },
    ],
}
